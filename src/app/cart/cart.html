<div class="cart-wrapper">
  <div class="cart-container" *ngIf="items.length; else emptyCart">

    <div class="cart-items">
      <h1 class="cart-title">Cart</h1>

      <div class="cart-item" *ngFor="let item of items">
        <div class="item-image">
          <img [src]="item.product.url" [alt]="item.product.name" />
        </div>

        <div class="item-info">
          <h2 class="item-name">{{ item.product.name }}</h2>
          <p class="item-price">
            {{ item.product.price | currency : 'USD' : 'symbol' }}
          </p>

          <div class="item-qty">
            <label>Amount</label>
            <input
              type="number"
              [(ngModel)]="item.quantity"
              (ngModelChange)="onQuantityChange()"
              min="1"
              name="qty-{{ item.product.id }}"
            />
          </div>
        </div>

        <div class="item-line-total">
          <span>
            {{
              (item.product.price * item.quantity) |
              currency : 'USD' : 'symbol' : '1.2-2'
            }}
          </span>
        </div>
      </div>
    </div>

    <div class="cart-summary">
      <h2>Order Summary</h2>

      <div class="summary-row">
        <span>Items</span>
        <span>{{ items.length }}</span>
      </div>

      <div class="summary-row total-row">
        <span>Total</span>
        <span>{{ total | currency : 'USD' : 'symbol' }}</span>
      </div>

      <form
        #checkoutForm="ngForm"
        (ngSubmit)="onSubmit(checkoutForm)"
        class="checkout-form"
      >
        <label>Full name</label>
        <input
          name="fullName"
          [(ngModel)]="fullName"
          required
          minlength="3"
          #fullNameCtrl="ngModel"
        />
        <div class="error" *ngIf="checkoutForm.submitted && fullNameCtrl.errors">
          <small *ngIf="fullNameCtrl.errors['required']">
            Full name is required.
          </small>
          <small *ngIf="fullNameCtrl.errors['minlength']">
            Name must be at least 3 characters.
          </small>
        </div>

        <label>Address</label>
        <input
          name="address"
          [(ngModel)]="address"
          required
          #addressCtrl="ngModel"
        />
        <div class="error" *ngIf="checkoutForm.submitted && addressCtrl.errors">
          <small *ngIf="addressCtrl.errors['required']">
            Address is required.
          </small>
        </div>

        <label>Credit card number</label>
        <input
          name="cardNumber"
          [(ngModel)]="cardNumber"
          required
          minlength="16"
          maxlength="16"
          #cardCtrl="ngModel"
        />
        <div class="error" *ngIf="checkoutForm.submitted && cardCtrl.errors">
          <small *ngIf="cardCtrl.errors['required']">
            Credit card number is required.
          </small>
          <small *ngIf="cardCtrl.errors['minlength']">
            Invalid credit card number.
          </small>
        </div>

        <button type="submit" class="checkout-btn">
          Checkout
        </button>
      </form>

      <button class="clear-btn" (click)="clearCart()">Clear cart</button>
    </div>
  </div>

  <ng-template #emptyCart>
    <div class="empty-cart">
      <img src="assets/images/empty-cart-eudzxdt3f49bo2oyjh77m.webp" alt="" />
      <h2>Your cart is empty</h2>
      <a routerLink="/products">Back to product list</a>
    </div>
  </ng-template>
</div>
